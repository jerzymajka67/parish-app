<body>
 <h2 ><%= title %></h2>
<div class="container-fluid">
  <div class="row" >
<!-- LEFT COLUMN: ACTIONS -->
    <div class="col-md-4 border-end p-3">
      <form id="uploadHtmlForm"
              action="/admin/about/upload-file"
              method="POST"
              enctype="multipart/form-data"
              class="mb-3 d-flex flex-column gap-2">
          <button type="submit"
                  class="btn btn-success"
                  id="uploadBtn">
            Upload HTML File
          </button>
          <input type="file"
                name="html"
                accept=".html"
                required
                class="form-control">
      </form>
      <form id="createHtmlForm"
              action="/admin/about/create-html"
              method="POST"
              class="mb-2 d-flex flex-column gap-2">
          <button type="submit" class="btn btn-success">
            Create HTML
          </button>
          <input type="text"
                name="fileName"
                placeholder="New HTML file name"
                required
                class="form-control">
      </form>
      <form id="renameForm" action="/admin/about/rename"
          method="POST"
          class="d-flex flex-column gap-2">
        <input id="renameOldName" type="hidden" name="fileName">
        <button type="submit"
            class="btn btn-amber">
            Rename
        </button> 
        <input id="renameNewName" type="text"
            name="newName"
            placeholder="New file name"
            required
            class="form-control">
      </form>
      <button id="editBtn"
              type="button"
              class="btn btn-secondary w-100 mt-3">
        Edit
      </button>
      <form id="viewForm" action="/admin/about/view"
              method="GET"
              target="_blank"
              class="d-grid gap-2 mt-3">
        <input id="viewFileName" type="hidden"
              name="fileName">
          <button type="submit" class="btn btn-outline-secondary">
             View
          </button>
      </form>
      <div class="d-flex gap-2 mt-3 mb-2">
        <form id="publishEnForm"
                action="/admin/about/publish-en"
                method="POST"
                class="flex-fill">
          <input id="publishEN" type="hidden"  name="fileName">
          <button type="submit" class="btn btn-primary w-100">
              Publish EN
          </button>
        </form>
        <form id="publishEsForm"
                action="/admin/about/publish-es"
                method="POST"
                class="flex-fill">
          <input id="publishES" type="hidden" name="fileName">
          <button type="submit" class="btn btn-primary w-100">
              Publish ES
          </button>
        </form>
      </div>
      <form id="deleteForm" method="POST"
            action="/admin/about/delete-file"
            class="mb-3 d-flex gap-2 align-items-center">

        <button type="button"
                class="btn btn-danger"
                id="deleteBtn">
          Delete
        </button>

        <input id="deleteFileName"
              type="hidden"
              name="fileName">
      </form>
    </div>
  <div class="col-md-8 p-4">
    <h4>Files</h4>
    <div class="row mt-3">
      <!-- LEFT: Browser -->
      <div class="col-md-7">
        <div class="border p-3">
          <div id="browser-container">
            <div id="browser" class="list-group">
              <!-- dynamically inserted items -->
            </div>
          </div>
        </div>
      </div>
      <!-- RIGHT: Welcome + Feedback -->
      <div class="col-md-5">
        <!-- WELCOME PANEL -->
        <div class="border p-3 mb-3 bg-light">
          <!-- SERVER FEEDBACK -->
            <% if (msg && status) { %>
              <div id="server-feedback" class="server-feedback <%= status %> border p-3 mt-3">
                <%= msg %>
              </div>
            <% } %>
          <h5>Welcome, Catalina & Samantha!</h5>
          <p>
            This page allows you to manage the <strong>About</strong> section of our parish website.
          </p>
          <p class="small">
            The About page should present who we are as a parish: our history, mission,
            leadership, and the spirit of our community. It should be clear, welcoming,
            and reflect our bilingual and multicultural identity.
          </p>

          <ul class="small">
            <li>You may <strong>upload existing HTML files</strong> or create new ones.</li>
            <li>You can <strong>edit files safely</strong> using the editor.</li>
            <li>The original file is never modified.</li>
            <li>When you edit a file, the system creates a new version with the same name plus the <strong>date and time of editing</strong>.</li>
            <li>After reviewing your changes, you may publish the page in <strong>English (EN)</strong> or <strong>Spanish (ES)</strong>.</li>
          </ul>
          <p class="small mb-0">
            Thank you for your dedication and generosity in serving our parish community.
          </p>
        </div>


      </div>
    </div>
  </div>
  <!-- CONFIRM DELETE MODAL -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm delete</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Delete <strong id="modal-folder-name"></strong>?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>
<!-- TINYMCE EDITOR MODAL -->
<div class="modal fade" id="editHtmlModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="editorTitle" class="modal-title"></h5>
      </div>
      <div id="editor"class="modal-body">
      </div>
      <div class="modal-footer">
        <button id="saveOnlyBtn"class="btn btn-success" >Save</button>
        <button id="saveExitBtn"class="btn btn-secondary" data-bs-dismiss="modal">Save & Exit</button>
      </div>
    </div>
  </div>
</div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      window.selectedFile = null;
      fetchFileList('/admin/about/ls');
      initDeleteModal(); 
      if (document.getElementById('editHtmlModal')) {
        initEditor();
        initEditButton();
      }
    });
    (function () {
  const feedback = document.getElementById('server-feedback');
  if (!feedback) return;

  // Auto-hide after 7 seconds
  setTimeout(() => {
    feedback.remove();
  }, 7000);
})();
  </script>
</body>
