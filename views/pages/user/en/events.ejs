<body>
   <main>
<div class="container-fluid mt-4 events-page">
  <div class="row">
    <!-- LEFT: INTRO TEXT -->
    <div class="col-md-7 p-5 intro-column">
      <h2 class="mb-4">Parish Events Gallery</h2>
      <p class="lead">
        On this page you will find photos from various parish events
        and interesting places within our parish community.
      </p>
      <div id="gallery" class="row g-3 mt-4"></div>
      <p>
        This page is still under construction, so for now we invite you
        to browse photos of
        <a href="/content/events/2026/01.%20January/Photos%20of%20our%20churches">
          our parish churches
        </a>
        as well as photos of the
        <a href="/content/events/2025/12.%20December/Schonstatt%20Movement%20in%20Our%20Parish">
          Schoenstatt Movement in our parish
        </a>.
      </p>
      <p>
        We hope that, with your help, this gallery will soon begin to fill
        with meaningful and beautiful photos that reflect the life
        and faith of our parish community.
      </p>
      <p class="signature">
        â€” Your Parish Community
      </p>
    </div>
    <!-- RIGHT: BROWSER -->
    <div class="col-md-5 border-start p-4 browser-column">
      <h5 class="mb-3">Parish Photo Gallery</h5>
      <div id="browser-container">
        <div id="browser" class="list-group"></div>
      </div>
    </div>
  </div>
</div>
</main>
<script>
  function renderGallery(folderPath, thumbs) {
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  thumbs.forEach(file => {
    const col = document.createElement('div');
    col.className = 'col-6 col-md-4 col-lg-3';
    const img = document.createElement('img');
    img.src = `/content/events/${folderPath}/thumbs/${file}`;
    img.onclick = () => {
      openImage(`/content/events/${folderPath}/${file}`);
    };
    col.appendChild(img);
    gallery.appendChild(col);
  });
}
  function loadGallery(folderPath) {
    fetch('/en/events/thumbs?path=' + encodeURIComponent(folderPath))
      .then(r => r.json())
      .then(data => {
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';
        if (!data.isGallery) {
          return; // not a gallery, nothing to show
        }
        data.thumbs.forEach(file => {
          const col = document.createElement('div');
          col.className = 'col-6 col-md-4 col-lg-3';
          const img = document.createElement('img');
          img.src = `/content/events/${folderPath}/thumbs/${file}`;
          img.onclick = () => {
            openImage(`/content/events/${folderPath}/${file}`);
          };
          col.appendChild(img);
          gallery.appendChild(col);
        });
      });
    }

document.addEventListener('DOMContentLoaded', () => {
  const browser = document.getElementById('browser');
  function render(tree, basePath, container) {
    for (const name in tree) {
      if (name === 'files') continue;
      const fullPath = basePath ? basePath + '/' + name : name;
      const folder = document.createElement('a');
      folder.href = '#';
      folder.className = 'list-group-item list-group-item-action fw-bold';
      folder.textContent = 'ðŸ“ ' + name;
      const collapse = document.createElement('div');
      collapse.className = 'collapse ps-3';
      const bs = new bootstrap.Collapse(collapse, { toggle: false });
        folder.onclick = async e => {
          e.preventDefault();
          e.stopPropagation();

          // 1ï¸âƒ£ Ask backend what this folder is
          const isGallery = await loadGallery(fullPath);

          // 2ï¸âƒ£ If it is a gallery â†’ DO NOT expand tree
          if (isGallery) {
            bs.hide();
            return;
          }

          // 3ï¸âƒ£ Normal folder behavior
          if (!collapse.hasChildNodes()) {
            load(fullPath, collapse);
          }

          bs.toggle();
        };
      container.append(folder, collapse);
    }
    (tree.files || []).forEach(file => {
      const filePath = basePath ? basePath + '/' + file : file;
      const link = document.createElement('a');
      link.className = 'list-group-item ps-4';
      link.href = '/content/events/' + encodeURIComponent(filePath);
      link.textContent = 'ðŸ“„ ' + file;
      container.appendChild(link);
    });
  }
  function load(path, container) {
    fetch('/en/events/ls?path=' + encodeURIComponent(path))
      .then(r => r.json())
      .then(data => render(data, path, container))
      .catch(err => console.error(err));
  }
  // initial load (root)
  fetch('/en/events/ls')
    .then(r => r.json())
    .then(data => render(data, '', browser))
    .catch(err => console.error(err));

});
</script>

  
</body>
