<body>
   <main>
<div class="container-fluid mt-4 events-page">
  <div class="row">
    <!-- LEFT: INTRO TEXT -->
    <div class="col-md-7 p-5 intro-column">
      <div id="gallery" class="row g-3 mt-4"></div>
      <h2 class="mb-4">Parish Events Gallery</h2>
      <p class="lead">
        On this page you will find photos from various parish events
        and interesting places within our parish community.
      </p>
      <p>
        This page is still under construction, so for now we invite you
        to browse photos of
        <a href="/content/events/2026/01.%20January/Photos%20of%20our%20churches">
          our parish churches
        </a>
        as well as photos of the
        <a href="/content/events/2025/12.%20December/Schonstatt%20Movement%20in%20Our%20Parish">
          Schoenstatt Movement in our parish
        </a>.
      </p>
      <p>
        We hope that, with your help, this gallery will soon begin to fill
        with meaningful and beautiful photos that reflect the life
        and faith of our parish community.
      </p>
      <p class="signature">
        â€” Your Parish Community
      </p>
    </div>
    <!-- RIGHT: BROWSER -->
    <div class="col-md-5 border-start p-4 browser-column">
      <h5 class="mb-3">Parish Photo Gallery</h5>
      <div id="browser-container">
        <div id="browser" class="list-group"></div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div id="modalContent" class="modal-content bg-dark">
      <button type="button" class="btn-close btn-close-white"
              data-bs-dismiss="modal"></button>

      <div class="modal-body text-center position-relative p-0">

        <button class="btn btn-dark position-absolute top-50 start-0 translate-middle-y fs-1 px-4"
                onclick="Viewer.prev()">â€¹</button>

        <img id="modalImage" class="img-fluid">

        <button class="btn btn-dark position-absolute top-50 end-0 translate-middle-y fs-1 px-4"
                onclick="Viewer.next()">â€º</button>

      </div>
    </div>
  </div>
</div>

</main>
<script>
document.addEventListener('DOMContentLoaded', () => {

  const browser = document.getElementById('browser');

  /* =========================
     GALLERY RENDER
  ========================== */

  function renderGallery(folderPath, thumbs) {

    const gallery = document.getElementById('gallery');
    gallery.innerHTML = '';

    const galleryPaths = thumbs.map(file =>
      `/content/events/${folderPath}/${file}`
    );

    // Give images to Viewer module
    Viewer.setGallery(galleryPaths);

    thumbs.forEach((file, index) => {
      const img = document.createElement('img');
      img.src = `/content/events/${folderPath}/thumbs/${file}`;
      img.onclick = () => Viewer.open(index);
      gallery.appendChild(img);
    });
  }

  /* =========================
     LOAD GALLERY
  ========================== */

  async function loadGallery(folderPath) {

    const res = await fetch(
      '/en/events/thumbs?path=' + encodeURIComponent(folderPath)
    );

    const data = await res.json();

    if (!data.isGallery) {
      document.getElementById('gallery').innerHTML = '';
      return false;
    }

    renderGallery(folderPath, data.thumbs);
    return true;
  }

  /* =========================
     FOLDER TREE
  ========================== */

  function render(tree, basePath, container) {

    for (const name in tree) {

      if (name === 'files') continue;
      if (name === 'thumbs') continue;

      const fullPath = basePath
        ? basePath + '/' + name
        : name;

      const folder = document.createElement('a');
      folder.href = '#';
      folder.className =
        'list-group-item list-group-item-action fw-bold';
      folder.textContent = 'ðŸ“ ' + name;

      const collapse = document.createElement('div');
      collapse.className = 'collapse ps-3';

      const bs = new bootstrap.Collapse(
        collapse,
        { toggle: false }
      );

      folder.onclick = async e => {
        e.preventDefault();
        e.stopPropagation();

        const isGallery = await loadGallery(fullPath);

        // If gallery â†’ do not expand tree
        if (isGallery) {
          bs.hide();
          return;
        }

        // Otherwise load subfolders
        if (!collapse.hasChildNodes()) {
          load(fullPath, collapse);
        }

        bs.toggle();
      };

      container.append(folder, collapse);
    }
  }

  function load(path, container) {
    fetch('/en/events/ls?path=' + encodeURIComponent(path))
      .then(r => r.json())
      .then(data => render(data, path, container))
      .catch(err => console.error(err));
  }

  /* =========================
     INITIAL LOAD
  ========================== */

  fetch('/en/events/ls')
    .then(r => r.json())
    .then(data => render(data, '', browser))
    .catch(err => console.error(err));

});
</script>
</body>
