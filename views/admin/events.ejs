
<main>
  <h2>Events â€“ File Manager</h2>
</main>

<!-- Breadcrumbs -->
<nav class="breadcrumbs">
  <a href="/admin/events">Events</a>
  <% breadcrumbs.forEach(crumb => { %>
    / <a href="/admin/events?path=<%= crumb.path %>"><%= crumb.name %></a>
  <% }) %>
</nav>

<!-- Navigation tools -->
<div class="admin-toolbar">

  <% if (currentPath) { %>
    <!-- UP button -->
    <a class="btn-action" href="/admin/events?path=<%= currentPath.split('/').slice(0, -1).join('/') %>">
      â¬† Up
    </a>
  <% } %>

</div>

<div id="tools">

  <h3>Folder contents</h3>

  <% if (items.length === 0) { %>
    <p>Empty folder</p>
  <% } else { %>

    <!-- DELETE SELECTED -->
    <form action="/admin/events/delete-selected" method="POST"
          onsubmit="return confirm('Delete selected files and folders?');">
      <input type="hidden" name="currentPath" value="<%= currentPath %>">

<ul class="file-list">
  <% if (items.length === 0) { %>
    <li class="empty">Empty folder</li>
  <% } else { %>
    <% items.forEach(item => { %>
      <li class="file-row">
        
        <!-- Checkbox for delete -->
        <input
          type="checkbox"
          name="selected[]"
          value="<%= item.type %>:<%= (currentPath ? currentPath + '/' : '') + item.name %>"
        >

        <% if (item.type === 'folder') { %>
          ğŸ“
          <a class="folder-link"
             href="/admin/events?path=<%= encodeURIComponent((currentPath ? currentPath + '/' : '') + item.name) %>">
            <%= item.name %>
          </a>
        <% } else { %>
          ğŸ–¼
          <!-- RESTORED: clicking filename opens image -->
          <a class="file-link"
             href="/content/events/<%= encodeURIComponent((currentPath ? currentPath + '/' : '') + item.name) %>"
             target="_blank">
            <%= item.name %>
          </a>
        <% } %>

      </li>
    <% }) %>
  <% } %>
</ul>


      <button type="submit" class="btn-action danger">
        Delete Selected
      </button>
    </form>

  <% } %>

  <!-- Upload image -->
  <form action="/admin/events/upload-image" method="POST"
      enctype="multipart/form-data" style="margin-top: 15px;">
    <input type="hidden" name="currentPath" value="<%= currentPath %>">
    <input type="file" name="image" accept="image/*" required>
    <button type="submit" class="btn-action">Upload Image</button>
  </form>


  <!-- Create folder -->
  <form action="/admin/events/create-folder" method="POST"
        style="margin-top: 10px;">
    <input type="hidden" name="currentPath" value="<%= currentPath %>">
    <input type="text" name="folderName" placeholder="New folder name" required>
    <button type="submit" class="btn-action">Create Folder</button>
  </form>

</div>
